<html>
	<head>
		<title>Project Bookworm - Book List</title>
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	</head>

	<body ng-app="app">
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
		<script src = "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular-route.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


		<div ng-view></div>

		<h1 align="center"> Book List </h1>


		<div style="width: 70%; margin: auto"> 

			<div style="float: right;">
				<!-- Trigger the modal with a button -->
				<button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#addBook">Add Book</button>
				<!-- Modal -->
				<div id="addBook" class="modal fade" role="dialog">
					<div class="modal-dialog">
						<!-- Modal content-->
						<div class="modal-content" ng-controller="form">
							<div class="modal-header">
								<h4 class="modal-title">Add Book</h4>
							</div>
							<div class="modal-body">

								<form>
									<div class="form-group">
										<label for="title">Title</label>
										<input type="text" class="form-control" id="title" ng-model="title">
									</div>
									<div class="form-group">
										<label>Author</label><br>

										<div style="float: left; width: 45%">
											<label for="firstName" style="font-weight: normal">First Name</label><br>
											<input type="text" class="form-control" id="firstName" ng-model="firstName">
										</div>
										<div style="float: right; width: 45%">
											<label for="lastName" style="font-weight: normal">Last Name</label><br>
											<input type="text" class="form-control" id="lastName" ng-model="lastName">
										</div>
									</div>
									
									<br><br><br>
									
									<div>
										<div class="form-group"  style="width: 45%; float: left">
											<label for="category">Category</label>
											<!--<select ng-model="selectedCategory" ng-options="x.categoryName for x in categories"></select>-->
											<input type="text" class="form-control" id="category" ng-model="category">
										</div>
										<div class="form-group" style="width: 45%; float: right">
											<label for="language">Language</label>
											<!--<select ng-model="selectedLanguage" ng-options="x.language for x in languages"></select>-->
											<input type="text" class="form-control" id="language" ng-model="language">
										</div>
									</div>
									<div>
										<div class="form-group" style="width: 45%; float: left">
											<label for="releaseDate">Release Date</label>
											<input type="date" class="form-control" id="releaseDate" ng-model="releaseDate">
										</div>
										
										<div class="form-group" style="width: 45%; float: right">
												<label for="coverURL">Cover URL</label>
												<input type="text" class="form-control" id="coverURL" ng-model="coverURL">
										</div>
									</div>
								</form>

								
							</div>
							<div class="modal-footer" style="margin-top: 20%;">
								<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
								<button type="submit" class="btn btn-info" ng-click="submit()">Submit</button>
							</div>
						</div>
					</div>
				</div>
			</div>


			<table class="table table-striped"  ng-controller="bookList">
	  			<thead>
	  				<th>Title</th>
	  				<th>Author</th>
	  				<th>Category</th>
	  			</thead>

	  			<tr ng-repeat="x in books">
	    			<td>{{x.title}</td>
	    			<td>{{x.author}}</td>
	    			<td>{{x.category}}</td>
	  			</tr>
			</table>

		</div>

		<script>
			var app = angular.module('app', ['ngRoute']);
			app.config(['$routeProvider', function($routeProvider){
  				$routeProvider.when("/",
    				{
				      templateUrl: "nav.htm"
				    }
			 	);
			}]);

			app.config(function ($httpProvider) {
				$httpProvider.defaults.headers.common = {};
				$httpProvider.defaults.headers.post = {};
				$httpProvider.defaults.headers.put = {};
				$httpProvider.defaults.headers.patch = {};
			});

			app.controller('welcome', function(){});

			app.controller('books', function($scope){
				$scope.change = function(){
        			return {"color": "white" , "background-color": "#B5B5B5"};
    			}
			});

			app.controller('form', function($scope, $http, $window) {
    			$scope.submit = function(){
    				$http.get("http://celinemarcelo.com:8004/v1/authors/search?firstName=" + $scope.firstName + "&lastName=" + $scope.lastName)
    				.then(function (response) {
    					console.log(response);

    					if(!response.firstName){
    						var body = {
    							firstName: $scope.firstName,
    							lastName: $scope.lastName
    						};

    						$http({
    							method: "POST",
    							url: "http://celinemarcelo.com:8004/v1/authors", 
    							headers: {
    								'Content-Type': 'application/json'
    							},
    							data: body
    						}).success(function (data, status) {
    							console.log(data);


    						});

    					}
    				});
    			};
			});


			app.controller('bookList', function($scope, $http) {
    			$http.get("http://celinemarcelo.com:8004/v1/books")
    			.then(function (response) {
    				$scope.books = response.data.books;
    			});
			});
		</script>




	</body>
</html>